<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
	
<mapper namespace="com.itwillbs.illusion.mapper.JobToolsMapper">
	
	<!-- 직무 대분류 값 가져오기  -->
	<select id="getOccupation">
		SELECT code, code_name
		  FROM common_code
		 WHERE code_group_id = 'OCCUPATION'
		   AND parent_code_id is null
	</select>
	
	<!--  직무 소분류 값 가져오기 -->
	<select id="getJobList">
		SELECT code, code_name
		  FROM common_code
		 WHERE code_group_id = 'occupation'	
		   AND parent_code_id = #{occupation};
	</select>
	
	<!-- 경력 가져오기 -->
	<select id="getExperience">
		SELECT code, code_name 
		  FROM common_code
		 WHERE code_group_id = "experience";
	</select>
	
	<!-- 자소서 저장하기 -->
	<insert id="saveCoverletter" 
			parameterType="map"
        	useGeneratedKeys="true"	 
        	keyProperty="cl_idx">
		INSERT INTO cover_letter
			(  member_idx
			 , cl_title
			 , company_name
			 , generated_cl_content
			 , generated_char_count
			 , generated_char_count_no_space)			  
	    VALUES (
		  	  1
		  	, #{title}
		  	, #{company}
		  	, #{aiResult}
		  	, #{generated_char_count}
		  	, #{generated_char_count_no_space} )
	</insert>
	
	<!-- 자소서 정보 가져오기 -->
	<select id="getCoverletterById">
	    SELECT 
	           cl_idx
	         , member_idx
	         , cl_title
	         , company_name
	         , generated_cl_content
	         , generated_char_count
	         , generated_char_count_no_space
	         , generation_date
	      FROM 
	          cover_letter
	     WHERE
	         cl_idx = #{cl_idx}
	</select>
	
	<update id="toggleSaveStatus" parameterType="int">
	     UPDATE cover_letter
	        SET is_saved_to_mypage = 
   	       CASE 
   	       WHEN is_saved_to_mypage = 'BOL001' THEN 'BOL002' 
	       ELSE 'BOL001'                                   
	        END
     	  WHERE cl_idx = #{cl_idx}
	</update>

	<select id="selectSaveStatus" parameterType="int" resultType="string">
   	     SELECT is_saved_to_mypage
   	       FROM cover_letter
   	      WHERE cl_idx = #{cl_idx}
	</select>
	
	<select id="getMemberToken">
		SELECT token
		  FROM member
		 WHERE member_idx = #{member_idx}	
	</select>
</mapper>