<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.itwillbs.illusion.mapper.ScrapMapper">
	
	<select id="getScrapsByMemberId" parameterType="int" resultType="com.itwillbs.illusion.vo.ScrapVO">
		SELECT s.scrap_idx
			 , s.member_idx
		     , s.recruit_idx
		     , r.start_date
		     , r.end_date
		     , r.recruit_subject
		     , c.code_name as rec_status
		  FROM scrap s LEFT JOIN recruit r ON s.recruit_idx = r.recruit_idx
		  LEFT JOIN common_code c ON r.rec_status = c.code
		 WHERE s.member_idx = #{memberIdx}
		 ORDER BY s.scrap_idx DESC
		 LIMIT #{startRow}, #{listLimit}
	</select>
	
	<select id="getScrapCountByMember" parameterType="com.itwillbs.illusion.vo.ScrapVO" resultType="int">
	    SELECT COUNT(*)
  	      FROM scrap
  	     WHERE member_idx = #{memberIdx}
	</select>
	
    <select id="selectScrapCount" parameterType="map" resultType="int">
        SELECT COUNT(*) 
          FROM scrap
         WHERE member_idx = #{member_idx} 
           AND recruit_idx = #{recruit_idx}
    </select>
    
    <!-- 스크랩 추가 -->
    <insert id="insertScrap" parameterType="map">
        INSERT INTO scrap (member_idx, recruit_idx)
        VALUES (#{member_idx}, #{recruit_idx})
    </insert>
    
    <!-- 스크랩 삭제 -->
    <delete id="deleteScrap" parameterType="map">
        DELETE 
          FROM scrap
         WHERE member_idx = #{member_idx} 
           AND recruit_idx = #{recruit_idx}
    </delete>
    
    <!-- 마이페이지 여러건 스크랩 삭제 -->
    <delete id="deleteScraps" parameterType="map">
    DELETE 
      FROM scrap
     WHERE member_idx = #{memberIdx}
       AND recruit_idx IN
        <foreach item="recruitIdx" collection="idList" open="(" separator="," close=")">
            #{recruitIdx}
        </foreach>
	</delete>
	
	
	
</mapper>