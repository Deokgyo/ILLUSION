package com.itwillbs.illusion.util;

import java.util.Map;

import org.springframework.stereotype.Component;

@Component
public class AIPromptManager {

	/**
	 * 자소서 생성을 위한 프롬프트 생성
	 */
	public String createGenerationPrompt(Map<String, String> params) {
		String company = params.getOrDefault("company", "해당 없음");
		String occupation = params.getOrDefault("occupation", "해당 없음");
		String question = params.getOrDefault("question", "자유 양식");
		String prevCompany = params.getOrDefault("prevCompany", "해당 없음");
		String prevJob = params.getOrDefault("prevJob", "해당 없음");
		String experience = params.getOrDefault("experience", "해당 없음");
		String keywords = params.getOrDefault("keywords", "해당 없음");
		String maxLength = params.getOrDefault("maxLength", "1000");
		String experiencePeriod = params.getOrDefault("experience_period", "");

		return String.format(
			"너는 대한민국 최고의 채용 컨설턴트이자 자기소개서 작성 전문가야. "
			+ "주어진 핵심 정보를 바탕으로, 지원자의 역량이 최대한 돋보이도록 매력적인 자기소개서를 '완성된 하나의 문단'으로 작성해줘.\n\n"
			+ "### 작성 조건:\n"
			+ "1. **지원 회사:** %s\n"
			+ "2. **지원 직무:** %s\n"
			+ "3. **자기소개서 문항:** %s\n"
			+ "4. **주요 경력:** %s에서 %s 직무를 %s 동안 수행함\n"
			+ "5. **핵심 경험/역량:** %s\n"
			+ "6. **필수 포함 키워드:** %s\n"
			+ "7. **분량:** 공백 미포함 %s자에 최대한 맞춰서 풍부하게 작성\n\n"
			+ "### 글쓰기 스타일 가이드:\n"
			+ "- **STAR 기법 활용:** 지원자의 핵심 경험을 서술할 때, '상황(Situation)-과제(Task)-행동(Action)-결과(Result)'가 명확히 드러나도록 구체적이고 논리적으로 작성해줘.\n"
			+ "- **직무 연관성 부각:** 경험과 성과가 지원 직무에 어떻게 기여할 수 있을지 명확하게 연결하여 서술해줘.\n"
			+ "- **전문적인 어투:** 긍정적이고 자신감 있는 어투를 사용하되, 성과를 구체적인 수치나 사실에 기반하여 진솔하게 표현해줘.\n"
			+ "- **가독성:** 문장은 간결하면서도 핵심 내용이 잘 전달되도록 구성하고, 맞춤법과 띄어쓰기를 완벽하게 지켜줘.\n"
			+ "- **출력 형식:** 다른 설명이나 제목 없이, 오직 완성된 자기소개서 본문 내용만 출력해줘.",
			company, occupation, question, prevCompany, prevJob, experiencePeriod, experience, keywords, maxLength
		);
	}

	/**
	 * 자소서 첨삭을 위한 프롬프트 생성
	 */
	public String createRefinementPrompt(String originalContent) {
		return String.format(
			"너는 대한민국 최고의 커리어 코치이자 자기소개서 첨삭 전문가야. "
			+ "아래의 [자소서 원문]을 '채용 담당자의 관점'에서 깊이 있게 분석하고, 지원자의 역량이 극대화되도록 수정 및 보완한 뒤 구체적인 피드백을 제공해줘.\n\n"
			+ "### 첨삭 지침:\n"
			+ "1. **내용 보강 및 가독성 향상:** 맞춤법, 띄어쓰기, 문법 오류를 교정하고, 길고 복잡한 문장은 간결하게 다듬어줘. 만약 내용이 부족하다면, 직무 역량을 어필할 수 있는 방향으로 내용을 더 풍부하게 보강해줘.\n"
			+ "2. **논리 구조 강화 (STAR 기법):** 경험 서술의 흐름이 '상황(S)-과제(T)-행동(A)-결과(R)'에 따라 명확히 드러나도록 문단 구조를 재배치하거나 연결어를 보강해줘.\n"
			+ "3. **성과 부각 및 수치화:** '노력했다', '기여했다' 같은 추상적인 표현을 '매출 15%% 증대', '프로세스 3일 단축' 등 구체적이고 측정 가능한 성과로 바꾸어 신뢰도를 높여줘.\n"
			+ "4. **직무 연관성 강화:** 지원자의 경험과 역량이 지원 직무에 정확히 어떻게 기여할 수 있는지 직접적이고 명확하게 연결하여 문장을 개선해줘.\n\n"
			+ "### 출력 형식 (매우 중요!):\n"
			+ "아래의 형식을 반드시 정확하게 지켜서 출력해줘. 각 섹션의 제목을 그대로 사용하고, 다른 부가적인 설명은 절대 추가하지 마.\n"
			+ "---[수정된 자기소개서]---\n"
			+ "(여기에 모든 지침이 반영되어, 내용까지 완벽하게 보강된 자기소개서 전체 내용을 작성)\n\n"
			+ "---[핵심 피드백]---\n"
			+ "1. **핵심 성과:** (가장 눈에 띄게 개선된 성과 표현에 대한 피드백과 수정 방향 제시)\n"
			+ "2. **문장 구조:** (논리적 흐름이나 가독성 측면에서 가장 효과적으로 개선된 부분에 대한 피드백과 수정 방향 제시)\n"
			+ "3. **직무 적합성:** (지원 직무와의 연결성이 어떻게 강화되었는지에 대한 피드백과 수정 방향 제시)\n\n"
			+ "### 자소서 원문:\n"
			+ "%s",
			originalContent
		);
	}

	/**
	 * 면접 예상 질문 생성을 위한 프롬프트 생성
	 */
	public String createInterviewPrompt(String originalContent) {
		return "당신은 회사의 베테랑 면접관입니다. 아래 자기소개서를 기반으로, 지원자의 역량과 잠재력을 파악하기 위한 날카로운 면접 질문 리스트를 생성해주세요.\n"
			+ "질문은 다음 세 가지 유형을 반드시 포함해야 합니다.\n"
			+ "1.경험 심층 질문: 주요 경험에 대해 STAR 기법을 활용한 핵심 질문과 그에 대한 꼬리 질문\n"
			+ "2.약점/압박 질문: 내용의 논리적 허점이나 약점을 파고드는 질문\n"
			+ "3.비전/기여도 질문: 회사에 어떻게 기여하고 함께 성장할 것인지 묻는 질문\n"
			+ "출력 형식 가이드 : 진짜 딱 질문만 3개만들어주고 다른 어떤 부연 설명도 넣지마, 꼬리 질문은 문장에 이어서 해줘 따로 '*'표시하지 말고, 질문사이에 구분은 줄바꿈만하고 공백 넣고 줄바꿈 또하지마 "
			+ "[자기 소개서 내용]\n"
			+ originalContent;
	}

	/**
	 * AI 면접 피드백을 위한 프롬프트 생성
	 */
	public String createAIFeedbackPrompt(String question, String answer) {
		return "당신은 20년 경력의 베테랑 면접관입니다. 당신이 제시했던 아래 [면접 질문]에 대해,"
			+ "지원자가 [지원자 답변]과 같이 대답했습니다. 지원자의 답변을 날카롭고 구체적으로 분석하여,"
			+ "다음 형식에 맞춰 피드백을 제공해주세요."
			+ "피드백은 지원자가 실질적으로 답변을 개선하는 데 도움이 되도록 구체적인 예시와 함께 설명해주세요."
			+ "[면접 질문]"
			+ question
			+ "[지원자 답변]"
			+ answer
			+ "[피드백 형식]"
			+ "1. 총평:답변에 대한 전반적인 인상과 합격/불합격에 미칠 영향을 한두 문장으로 요약해주세요."
			+ "2. 잘한 점: 구조적 완성도: 답변이 STAR(상황-과제-행동-결과) 기법에 따라 체계적으로 구성되었는지 평가해주세요."
			+ "핵심 역량 어필: 답변을 통해 지원자의 어떤 역량(예: 문제 해결 능력, 주도성, 소통 능력 등)이 효과적으로 드러났는지 짚어주세요.\n"
			+ "표현 및 전달력: 답변의 논리 전개가 명확하고, 사용된 어휘나 어조가 자신감 있고 긍정적인 인상을 주는지 평가해주세요."
			+ "한문 장으로 해주세요"
			+ "3. 개선할 점:"
			+ "구체성 부족: \"열심히 했습니다\", \"좋은 결과를 얻었습니다\" 와 같이 추상적인 표현이 있다면, 이를 구체적인 수치나 객관적인 사실로 바꿀 수 있도록 예시를 들어 제안해주세요."
			+ "논리적 허점: 주장의 근거가 부족하거나, 행동과 결과 사이의 인과관계가 명확하지 않은 부분을 지적하고 보완할 점을 설명해주세요."
			+ "질문 의도 파악: 면접관의 질문 의도에서 벗어난 부분은 없는지, 혹은 더 강조했어야 할 포인트는 무엇인지 알려주세요."
			+ "한문 장으로 해주세요"
			+ " [출력 형식]"
			+ "각 항목들은 줄바꿈으로 구분좀 제대로 해줘 너의 답변이 그대로(줄바꿈, 띄어쓰기, 특수문자 강조표현등) 사용자에게 보여지는거야"
			+ "그리고 전체 내용이 너무길어 16px 기준으로 5~6줄 정도로만 해줘, 1.너의 답변 \n 2. 너의답변 \n .. 이런형식으로 "
			+ "줄바꿈을 html 코드로 해줄래?, 아니 *(아스트리카) 빼라고 ;;;";
	}
}